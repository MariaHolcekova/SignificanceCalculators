
<!DOCTYPE html>
<html>
<head>
  <title>Calculator</title>
  <style type="text/css">
    .error {
        color: red;
        text-decoration: underline;
    }
    h1 {
        background-image: url("annie-spratt-r_m-JKJVto0-unsplash.jpg");
        height: 11vw; 
        background-repeat: repeat-y; 
        background-size: cover; 
        padding: 1vw;
        font-size: 4vw;
        margin-top: 0px;
        color: black;
        margin: 0px;
    }
    .calculator1 {
        padding: 30px;
        margin-top: 20px;
        margin-left: 10px;
        background-color: #c3ccff;
        width: 50vw;
    }
    .calculator2 {
        padding: 30px;
        margin-top: 20px; 
        margin-right: 10px; 
        background-color: #ffe5be;
        width: 50vw;
    }
    body {
        background-color: #fcfcfc;
    }
    .sample {
        color: #3a58ff;
        margin-top: 0px;
    }
    .sig {
        color: #ff9800;
        margin-top: 0px;
    }
    .flex {
        display: flex;
        gap: 40px;
    }
    .button {
        margin-top: 30px;
    }
    .input {
        margin-bottom: 10px;
    }
    .answer-number {
        font-size: 20px;
        font-weight: bold;
    }

  </style>
</head>

<body>
    <h1>
        Sample size & <br> Significance calculators
    </h1>
    <div class="flex">
    <div class="calculator1">
    <h2 class="sample">
        Sample Size calculator
        </h2>
    <p>
        The sample size calculator lets you find out the minimum sample size required in order to detect a statistically significant difference of a certain value between your Control and Exposed groups.
        <br>It determines the minimum sample size for three different levels of statistical significance (i.e. confidence intervals): 80%, 90%, and 95%.
        </p>
        <br>
 <form id="Sample">
     <label for="Control">
        Control %
     </label>
     <input type="number" id="Control" step="any" min=0 max=100 class="input">
     <br>
     <label for="Exposed">
        Exposed %
     </label>
     <input type="number" id="Exposed" step="any" min=0 max=100 class="input">
     <br>
     <label for="Confidence">
        Confidence Interval
     </label>
     <select id="Confidence" class="input">
<option value="1.64">
    95%
</option>
<option value="1.28">
    90%
</option>
<option value="0.84">
    80%
</option>
     </select>
     <br>
<input type="submit" value="Calculate" class="button">
 </form>
 <p id="Result">
 </p>
 <br>
</div>

<div class="calculator2">
<h2 class="sig">
Significance calculator
</h2>
<p>
    The significance calculator is a great way to quickly test whether your NBE results might be statistically significant at a different level than the one tested in the Nielsen report.
    </p>
    <br>
<form id="Significance">
    <label for="ControlSample1">
        Control sample size
     </label>
     <input type="number" id="ControlSample1" step="any" min=1 class="input">
     <label for="Control1">
        Control %
     </label>
     <input type="number" id="Control1" step="any" min=0 max=100 class="input">
    <br>

    <label for="ExposedSample1">
        Exposed sample size
     </label>
     <input type="number" id="ExposedSample1" step="any" min=1 class="input">
    <label for="Exposed1">
       Exposed %
    </label>
    <input type="number" id="Exposed1" step="any" min=0 max=100 class="input">
    <br>

<input type="submit" value="Calculate" class="button">
</form>
<p id="Result1">
</p>
<br>
</div>
</div>

 <script type="text/javascript">
    function show_result (element, message, iserror) {
        if (iserror) {
            element.className="error"
        }
        else {
            element.className=""
        }
        element.innerHTML = message 
    }
    function calculate_sample (e) {
        e.preventDefault();
        const control = parseFloat(document.getElementById("Control").value)/100;
        const exposed = parseFloat(document.getElementById("Exposed").value)/100;
        const confidence = parseFloat(document.getElementById("Confidence").value);
        const sample_size = Math.ceil((((control*(1-control))+(exposed*(1-exposed)))/(Math.pow(control-exposed,2)))*(1.28+confidence))
        const result = document.getElementById("Result")
        if(control==exposed) {
            show_result(result, `The percentages cannot be equal`, true);
        }
        else if (sample_size<100) {
            show_result(result, `The minimum sample size required per each bucket is 100`, true);
        }
        else {
            show_result(result, `The minimum sample size required per each bucket is <span class="answer-number">${sample_size}</span>`, false);
        }
    }
    document.getElementById("Sample").addEventListener("submit", calculate_sample)

    function round5(x)
{
    return Math.floor(x/5)*5;
}
    function stdNormal(z) {
    var j, k, kMax, m, values, total, subtotal, item, z2, z4, a, b;

    // Power series is not stable at these extreme tail scenarios
    if (z < -6) { return 0; }
    if (z >  6) { return 1; }

    m      = 1;        // m(k) == (2**k)/factorial(k)
    b      = z;        // b(k) == z ** (2*k + 1)
    z2     = z * z;    // cache of z squared
    z4     = z2 * z2;  // cache of z to the 4th
    values = [];

    // Compute the power series in groups of two terms.
    // This reduces floating point errors because the series
    // alternates between positive and negative.
    for (k=0; k<100; k+=2) {
        a = 2*k + 1;
        item = b / (a*m);
        item *= (1 - (a*z2)/((a+1)*(a+2)));
        values.push(item);
        m *= (4*(k+1)*(k+2));
        b *= z4;
    }

    // Add the smallest terms to the total first that
    // way we minimize the floating point errors.
    total = 0;
    for (k=49; k>=0; k--) {
        total += values[k];
    }

    // Multiply total by 1/sqrt(2*PI)
    // Then add 0.5 so that stdNormal(0) === 0.5
    return round5(((0.5 + 0.3989422804014327 * total))*100);
}

    function calculate_sig (e) {
        e.preventDefault();
        const control_sample = parseFloat(document.getElementById("ControlSample1").value);
        const control_perc = parseFloat(document.getElementById("Control1").value)/100;
        const control_se = Math.sqrt((control_perc*(1-control_perc)/control_sample));
        const exposed_sample = parseFloat(document.getElementById("ExposedSample1").value);
        const exposed_perc = parseFloat(document.getElementById("Exposed1").value)/100;
        const exposed_se = Math.sqrt((exposed_perc*(1-exposed_perc)/exposed_sample));
        const delta = exposed_perc - control_perc;
        const z_score = Math.abs(delta)/Math.sqrt(Math.pow(control_se,2)+(Math.pow(exposed_se,2)))
        const significance = stdNormal(z_score)
        const result = document.getElementById("Result1")
        if(control_sample<30 || exposed_sample<30) {
            show_result(result, `The minimum required sample size in each bucket is 30`, true);
        }
        else if(control_perc==exposed_perc) {
            show_result(result, `The percentages cannot be equal`, true);
        }
        else if(significance < 5) {
            show_result(result, `The difference is significant at 99% confidence interval`, false);
        }
        else {
            show_result(result, `The difference is significant at <span class="answer-number">${significance}%</span> confidence interval`, false);
        }        

    }
    
    document.getElementById("Significance").addEventListener("submit", calculate_sig)


      </script>
</body>
</html>
