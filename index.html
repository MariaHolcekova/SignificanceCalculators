
<!DOCTYPE html>
<html>
<head>
  <title>Calculator</title>
  <style type="text/css">
      body {
        background-color: #fcfcfc;
        font-family: Arial, Helvetica, sans-serif;
    }
    h1 {
        background-image: url("annie-spratt-r_m-JKJVto0-unsplash.jpg");
        height: 3.5em; 
        background-repeat: repeat-y; 
        background-size: cover; 
        padding: 0.8rem;
        font-size: 2em;
        margin-top: 0px;
        color: black;
        margin: 0px;
        font-family: Arial, Helvetica, sans-serif;
    }
    .quote {
        text-align: right;
        margin-bottom: 3rem;
        padding-right: 1em;
        font-family: Arial, Helvetica, sans-serif;
        font-style: italic;
        margin-top: 0.5rem;
        font-size: 1.3em;
    }
    .links {
        font-weight: bold;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 1.1em;
        margin: 1.1em;
        color: white;
    text-decoration: none;
    background-color: maroon;
    padding: 0.5em;
    }
    .inline {
        display: inline;
    }
    .calculator {
        padding: 30px;
        padding-top: 15px;
        margin: 1.1em;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 1em;
        flex-grow: 1;
        padding-bottom: 3em;
        margin-bottom: 10em;
        margin-top: 2.5em;
        border-radius: 2em;
    }
    .light_blue {
        background-color: #c1dce8;
    }
    .light_orange {
        background-color: #ffe5bf;
    }
    .dark_blue {
        color: #508198;
    }
    .dark_orange {
        color: #ff9800;
    }
    p {
        margin-top: 1rem;
        margin-bottom: 5px;
    }
    .title {
        margin-top: 0px;
        margin-bottom: 30px;
        font-family: Arial, Helvetica, sans-serif;
    }
    .flex {
        display: flex;
        flex-direction: row;
    }
    @media screen and (max-width: 800px) {
        .flex {
            flex-direction: column;
        }
    }
    .button {
        margin-top: 15px;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 1em;
        background-color: #4caf50;
        border-color: teal;
        padding: 0.4vw;
        margin-top: 1.5em;
        border-radius: 0.7em;
    }
    .input {
        margin-bottom: 10px;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 0.8em;
    }
    .answer-number {
        font-size: 20px;
        font-weight: bold;
        font-family: Arial, Helvetica, sans-serif;
    }
    .desc {
        margin-top: 10px;
        font-family: Arial, Helvetica, sans-serif;
        line-height: 130%;
        margin-bottom: 3em;
        font-size: 1em;
    }
    .highlight {
        font-weight: bold;
    }
    .error {
        color: red;
        text-decoration: underline;
    }
    .tooltip {
        position: relative;
  display: inline-block;
  border-bottom: 1px dotted black;
    }
    .tooltip .tooltiptext {
  visibility: hidden;
  width: 13em;
  background-color: black;
  color: #fff;
  text-align: left;
  padding: 5px;
  border-radius: 6px;
  font-size: 0.9rem;
  position: absolute;
  z-index: 1;
}
.tooltip:hover .tooltiptext {
  visibility: visible;
}

</style>

</head>

<body>
    <h1>
        Sample size & <br> Significance calculators
    </h1>
    <p class="quote">
        "With a large enough sample, any outrageous thing is likely to happen" - Frederick Mosteller
    </p>
    <p class="inline">
        <a href="#read_me" class="links">READ ME</a>
    </p> 
    <p class="inline">
        <a href="#instructions" class="links">INSTRUCTIONS</a>
    </p> 
    <div class="flex">
    <div class="calculator light_orange">
    <h2 class="title dark_orange tooltip">
        Sample Size calculator
        <span class="tooltiptext">The sample size calculator lets you find out the minimum sample size required in order to detect a statistically significant difference of a certain value between your Control and Exposed groups.</span>
        </h2>
        <br>
 <form id="Sample">
     <label for="Control" class="tooltip">
        Control %
        <span class="tooltiptext">The expected percentage of instances among control group (e.g. percentage aware of a brand)</span>
     </label>
     <input type="number" id="Control" step="any" min=0 max=100 class="input">
     <br>
     <label for="Exposed" class="tooltip">
        Exposed %
        <span class="tooltiptext">The expected percentage of instances among exposed group (e.g. percentage aware of a brand)</span>
     </label>
     <input type="number" id="Exposed" step="any" min=0 max=100 class="input">
     <br>
     <label for="Confidence"  class="tooltip">
        Confidence Interval
        <span class="tooltiptext">Confidence interval at which you want the difference to be statistically significant (the higher the CI, the greater the sample required)</span>
     </label>
     <select id="Confidence" class="input">
<option value="1.64">
    95%
</option>
<option value="1.28">
    90%
</option>
<option value="0.84">
    80%
</option>
     </select>
     <br>
<input type="submit" value="Calculate" class="button">
 </form>
 <p id="Result">
 </p>
 <br>
</div>

<div class="calculator light_blue">
<h2 class="title dark_blue tooltip">
Significance calculator
<span class="tooltiptext">The significance calculator is a great way to quickly test whether your Brand Effect results might be statistically significant at a different level than the one tested in the vendor report.</span>
</h2>
    <br>
<form id="Significance">
    <label for="ControlSample1"  class="tooltip">
        Control sample size
        <span class="tooltiptext">The number of respondents in your survey within the control group</span>
     </label>
     <input type="number" id="ControlSample1" step="any" min=1 class="input">
     <label for="Control1" class="tooltip">
        Control %
        <span class="tooltiptext">The observed percentage of instances among control group (e.g. percentage aware of a brand)</span>
     </label>
     <input type="number" id="Control1" step="any" min=0 max=100 class="input">
    <br>

    <label for="ExposedSample1"  class="tooltip">
        Exposed sample size
        <span class="tooltiptext">The number of respondents in your survey within the exposed group</span>
     </label>
     <input type="number" id="ExposedSample1" step="any" min=1 class="input">
    <label for="Exposed1"  class="tooltip">
       Exposed %
       <span class="tooltiptext">The observed percentage of instances among exposed group (e.g. percentage aware of a brand)</span>
    </label>
    <input type="number" id="Exposed1" step="any" min=0 max=100 class="input">
    <br>

<input type="submit" value="Calculate" class="button">
</form>
<p id="Result1">
</p>
<br>
</div>
</div>

 <script type="text/javascript">
    function show_result (element, message, iserror) {
        if (iserror) {
            element.className="error"
        }
        else {
            element.className=""
        }
        element.innerHTML = message 
    }
    function calculate_sample (e) {
        e.preventDefault();
        if (document.getElementById("Control").value == "" || document.getElementById("Exposed").value == "") {
            alert("The cells cannot be empty");
            return false;
        }
        else { 
            const control = parseFloat(document.getElementById("Control").value)/100;
            const exposed = parseFloat(document.getElementById("Exposed").value)/100;
            const confidence = parseFloat(document.getElementById("Confidence").value);
            const sample_size = Math.ceil((((control*(1-control))+(exposed*(1-exposed)))/(Math.pow(control-exposed,2)))*(1.28+confidence))
            const result = document.getElementById("Result")
            if(control==exposed) {
                show_result(result, `The percentages cannot be equal`, true);
            }
            else if (sample_size<100) {
                show_result(result, `The minimum sample size required per each bucket is <span class="answer-number">100</span>`, false);
            }
            else {
                show_result(result, `The minimum sample size required per each bucket is <span class="answer-number">${sample_size}</span>`, false);
            }
        }
    }
    document.getElementById("Sample").addEventListener("submit", calculate_sample)

    function round5(x)
{
    return Math.floor(x/5)*5;
}
    function stdNormal(z) {
    var j, k, kMax, m, values, total, subtotal, item, z2, z4, a, b;

    // Power series is not stable at these extreme tail scenarios
    if (z < -6) { return 0; }
    if (z >  6) { return 1; }

    m      = 1;        // m(k) == (2**k)/factorial(k)
    b      = z;        // b(k) == z ** (2*k + 1)
    z2     = z * z;    // cache of z squared
    z4     = z2 * z2;  // cache of z to the 4th
    values = [];

    // Compute the power series in groups of two terms.
    // This reduces floating point errors because the series
    // alternates between positive and negative.
    for (k=0; k<100; k+=2) {
        a = 2*k + 1;
        item = b / (a*m);
        item *= (1 - (a*z2)/((a+1)*(a+2)));
        values.push(item);
        m *= (4*(k+1)*(k+2));
        b *= z4;
    }

    // Add the smallest terms to the total first that
    // way we minimize the floating point errors.
    total = 0;
    for (k=49; k>=0; k--) {
        total += values[k];
    }

    // Multiply total by 1/sqrt(2*PI)
    // Then add 0.5 so that stdNormal(0) === 0.5
    return round5(((0.5 + 0.3989422804014327 * total))*100);
}

    function calculate_sig (e) {
        e.preventDefault();
        if (document.getElementById("Control1").value == "" || document.getElementById("Exposed1").value == "" ||
        document.getElementById("ControlSample1").value == "" || document.getElementById("ExposedSample1").value == "") {
            alert("The cells cannot be empty");
            return false;
        }
        else { 
            const control_sample = parseFloat(document.getElementById("ControlSample1").value);
            const control_perc = parseFloat(document.getElementById("Control1").value)/100;
            const control_se = Math.sqrt((control_perc*(1-control_perc)/control_sample));
            const exposed_sample = parseFloat(document.getElementById("ExposedSample1").value);
            const exposed_perc = parseFloat(document.getElementById("Exposed1").value)/100;
            const exposed_se = Math.sqrt((exposed_perc*(1-exposed_perc)/exposed_sample));
            const delta = exposed_perc - control_perc;
            const z_score = Math.abs(delta)/Math.sqrt(Math.pow(control_se,2)+(Math.pow(exposed_se,2)))
            const significance = stdNormal(z_score)
            const result = document.getElementById("Result1")
            if(control_sample<30 || exposed_sample<30) {
                show_result(result, `The minimum required sample size in each bucket is 30`, true);
            }
            else if(control_perc==exposed_perc) {
                show_result(result, `The percentages cannot be equal`, true);
            }
            else if(significance < 5) {
                show_result(result, `The difference is significant at <span class="answer-number">99%</span> confidence interval`, false);
            }
            else if(significance < 80 & significance >=5) {
                show_result(result, `The difference is significant at <span class="answer-number">${significance}%</span> confidence interval`, false);
            }
            else {
                show_result(result, `The difference is significant at <span class="answer-number">${significance}%</span> confidence interval`, false);
            }        

        }
    }
    document.getElementById("Significance").addEventListener("submit", calculate_sig)


      </script>
              <a name="read_me"> READ ME
                <p class="desc">
    <span class="highlight"> Both calculators are set to test one-tailed alternative hypothesis.</span> This means that, for instance, 
    when you enter 30% for Control group and 40% for Exposed group, the Sample size calculator will evaluate 
    the significance of the 10 percentage point increase only. This is done to reduce the unnecessary sample size/significance requirements 
    of a two-tailed test, seeing as we rarely strive for negative lifts.
<br>
    Also, an <span class="highlight"> important assumption of these calculators is equal <a href="https://en.wikipedia.org/wiki/Variance"  target="_blank">variances</a> within each group</span> (Control and Exposed). 
    This means that we expect to see the lift to be statistically significant only if the extent of variability in each group is the same, 
    i.e. if for some reason we collected a sample of Control group that feel very strongly towards the product 
    but the Exposed sample within the same study have a more varied mixture of attitudes, the lift might not end up statistically significant 
    even with sufficient sample size due to the unequal variance of attitudes within the groups. 
    <br> Equally, if the variability is too large in both groups, the likelihood of picking up a sgnificant effect between them is fairly small.
</p>

</a>
<a name="instructions"> Instructions
    <p class="desc">

    </p>
    </a>

</body>
</html>
