
<!DOCTYPE html>
<html>
<head>
  <title>Calculator</title>
  <style type="text/css">
    .error {
        color: red;
        text-decoration: underline;
    }
    h1 {
        background-image: url("annie-spratt-r_m-JKJVto0-unsplash.jpg");
        height: 11vw; 
        background-repeat: repeat-y; 
        background-size: cover; 
        padding: 1vw;
        font-size: 4vw;
        margin-top: 0px;
        color: black;
        margin: 0px;
        font-family: Arial, Helvetica, sans-serif;
    }
    .calculator1 {
        padding: 30px;
        padding-top: 15px;
        margin-top: 20px;
        margin-left: 10px;
        background-color: #ffe5bf;
        width: 50vw;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 15px;
    }
    .calculator2 {
        padding: 30px;
        padding-top: 15px;
        margin-top: 20px; 
        margin-right: 10px; 
        background-color: #c1dce8;
        width: 50vw;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 15px;
    }
    body {
        background-color: #fcfcfc;
        font-family: Arial, Helvetica, sans-serif;
    }
    .sample {
        color: #ff9800;
        margin-top: 0px;
        font-family: Arial, Helvetica, sans-serif;
    }
    .sig {
        color: #508198;
        margin-top: 0px;
        font-family: Arial, Helvetica, sans-serif;
    }
    .flex {
        display: flex;
        gap: 40px;
    }
    .button {
        margin-top: 15px;
        font-family: Arial, Helvetica, sans-serif;
    }
    .input {
        margin-bottom: 10px;
        font-family: Arial, Helvetica, sans-serif;
    }
    .answer-number {
        font-size: 20px;
        font-weight: bold;
        font-family: Arial, Helvetica, sans-serif;
    }
    .quote {
        text-align: center;
        font-size: larger;
        margin-bottom: 30px;
        font-family: Arial, Helvetica, sans-serif;
        font-style: italic;
        margin-top: 5px;
    }
    .read_me {
        color: tomato;
        font-weight: bold;
        text-decoration: underline;
        margin-block-end: 0px;
        font-family: Arial, Helvetica, sans-serif;
    }
    .desc {
        margin-top: 10px;
        font-family: Arial, Helvetica, sans-serif;
        line-height: 130%;
        margin-bottom: 0px;
    }
    .highlight {
        font-weight: bold;
    }

  </style>
</head>

<body>
    <h1>
        Sample size & <br> Significance calculators
    </h1>
    <p class="quote">
        "With a large enough sample, any outrageous thing is likely to happen" - Frederick Mosteller
    </p>
    <p class="read_me">
        READ ME 
    </p>
        <p class="desc">
        <span class="highlight"> Both calculators are set to test one-tailed alternative hypothesis.</span> This means that, for instance, 
        when you enter 30% for Control group and 40% for Exposed group, the Sample size calculator will evaluate 
        the significance of the 10 percentage point increase only. This is done to reduce the unnecessary sample size/significance requirements 
        of a two-tailed test, seeing as we rarel strive for negative lifts.
        </p>
        <p class="desc">
        Also, an <span class="highlight"> important assumption of these calculators is equal variances within each group</span> (Control and Exposed). 
        This means that we expect to see the lift to be statistically significant only if the extent of variability in each group is the same, 
        i.e. if for some reason we collected a sample of Control group that feel very strongly towards the product 
        but the Exposed sample within the same study have a more varied mixture of attitudes, the lift might not end up statistically significant 
        even with sufficient sample size due to the unequal variance of attitudes within the groups. 
        <br> Equally, if the variability is too large in both groups, the likelihood of picking up a sgnificant effect between them is fairly small.
    </p>
    <div class="flex">
    <div class="calculator1">
    <h2 class="sample">
        Sample Size calculator
        </h2>
    <p>
        The sample size calculator lets you find out the minimum sample size required in order to detect a statistically significant difference of a certain value between your Control and Exposed groups.
        <br>
        <br>It determines the minimum sample size for three different levels of statistical significance (i.e. confidence intervals): 80%, 90%, and 95%.
        </p>
        <br>
 <form id="Sample">
     <label for="Control">
        Control %
     </label>
     <input type="number" id="Control" step="any" min=0 max=100 class="input">
     <br>
     <label for="Exposed">
        Exposed %
     </label>
     <input type="number" id="Exposed" step="any" min=0 max=100 class="input">
     <br>
     <label for="Confidence">
        Confidence Interval
     </label>
     <select id="Confidence" class="input">
<option value="1.64">
    95%
</option>
<option value="1.28">
    90%
</option>
<option value="0.84">
    80%
</option>
     </select>
     <br>
<input type="submit" value="Calculate" class="button">
 </form>
 <p id="Result">
 </p>
 <br>
</div>

<div class="calculator2">
<h2 class="sig">
Significance calculator
</h2>
<p>
    The significance calculator is a great way to quickly test whether your Brand Effect results might be statistically significant at a different level than the one tested in the vendor report.
    </p>
    <br>
<form id="Significance">
    <label for="ControlSample1">
        Control sample size
     </label>
     <input type="number" id="ControlSample1" step="any" min=1 class="input">
     <label for="Control1">
        Control %
     </label>
     <input type="number" id="Control1" step="any" min=0 max=100 class="input">
    <br>

    <label for="ExposedSample1">
        Exposed sample size
     </label>
     <input type="number" id="ExposedSample1" step="any" min=1 class="input">
    <label for="Exposed1">
       Exposed %
    </label>
    <input type="number" id="Exposed1" step="any" min=0 max=100 class="input">
    <br>

<input type="submit" value="Calculate" class="button">
</form>
<p id="Result1">
</p>
<br>
</div>
</div>

 <script type="text/javascript">
    function show_result (element, message, iserror) {
        if (iserror) {
            element.className="error"
        }
        else {
            element.className=""
        }
        element.innerHTML = message 
    }
    function calculate_sample (e) {
        e.preventDefault();
        const control = parseFloat(document.getElementById("Control").value)/100;
        const exposed = parseFloat(document.getElementById("Exposed").value)/100;
        const confidence = parseFloat(document.getElementById("Confidence").value);
        const sample_size = Math.ceil((((control*(1-control))+(exposed*(1-exposed)))/(Math.pow(control-exposed,2)))*(1.28+confidence))
        const result = document.getElementById("Result")
        if(control==exposed) {
            show_result(result, `The percentages cannot be equal`, true);
        }
        else if (sample_size<100) {
            show_result(result, `The minimum sample size required per each bucket is <span class="answer-number">100</span>`, false);
        }
        else {
            show_result(result, `The minimum sample size required per each bucket is <span class="answer-number">${sample_size}</span>`, false);
        }
    }
    document.getElementById("Sample").addEventListener("submit", calculate_sample)

    function round5(x)
{
    return Math.floor(x/5)*5;
}
    function stdNormal(z) {
    var j, k, kMax, m, values, total, subtotal, item, z2, z4, a, b;

    // Power series is not stable at these extreme tail scenarios
    if (z < -6) { return 0; }
    if (z >  6) { return 1; }

    m      = 1;        // m(k) == (2**k)/factorial(k)
    b      = z;        // b(k) == z ** (2*k + 1)
    z2     = z * z;    // cache of z squared
    z4     = z2 * z2;  // cache of z to the 4th
    values = [];

    // Compute the power series in groups of two terms.
    // This reduces floating point errors because the series
    // alternates between positive and negative.
    for (k=0; k<100; k+=2) {
        a = 2*k + 1;
        item = b / (a*m);
        item *= (1 - (a*z2)/((a+1)*(a+2)));
        values.push(item);
        m *= (4*(k+1)*(k+2));
        b *= z4;
    }

    // Add the smallest terms to the total first that
    // way we minimize the floating point errors.
    total = 0;
    for (k=49; k>=0; k--) {
        total += values[k];
    }

    // Multiply total by 1/sqrt(2*PI)
    // Then add 0.5 so that stdNormal(0) === 0.5
    return round5(((0.5 + 0.3989422804014327 * total))*100);
}

    function calculate_sig (e) {
        e.preventDefault();
        const control_sample = parseFloat(document.getElementById("ControlSample1").value);
        const control_perc = parseFloat(document.getElementById("Control1").value)/100;
        const control_se = Math.sqrt((control_perc*(1-control_perc)/control_sample));
        const exposed_sample = parseFloat(document.getElementById("ExposedSample1").value);
        const exposed_perc = parseFloat(document.getElementById("Exposed1").value)/100;
        const exposed_se = Math.sqrt((exposed_perc*(1-exposed_perc)/exposed_sample));
        const delta = exposed_perc - control_perc;
        const z_score = Math.abs(delta)/Math.sqrt(Math.pow(control_se,2)+(Math.pow(exposed_se,2)))
        const significance = stdNormal(z_score)
        const result = document.getElementById("Result1")
        if(control_sample<30 || exposed_sample<30) {
            show_result(result, `The minimum required sample size in each bucket is 30`, true);
        }
        else if(control_perc==exposed_perc) {
            show_result(result, `The percentages cannot be equal`, true);
        }
        else if(significance < 5) {
            show_result(result, `The difference is significant at <span class="answer-number">99%</span> confidence interval`, false);
        }
        else if(significance < 80 & significance >=5) {
            show_result(result, `The difference is significant at <span class="answer-number">${significance}%</span> confidence interval <span class="answer-number">[Not significant]</span> `, false);
        }
        else {
            show_result(result, `The difference is significant at <span class="answer-number">${significance}%</span> confidence interval`, false);
        }        

    }
    
    document.getElementById("Significance").addEventListener("submit", calculate_sig)


      </script>
</body>
</html>
